# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

**Товар**
```
interface IProduct {
    id: string;
    title: string;
    category: string;
    description: string;
    price: number | null; 
    image: string;
}
```
**Данные об оплате**
```
interface IPayment {
    adress: string;
    telNum: string;
    email: string;
    paymentType: string;
}
```

**Ответ сервера при успешной покупке**
```
interface PaymentResponse {
    total: number;
    id: string;
}
```

**Jтвет сервера для получения списка товаров**
```
type IProductResponse = {
    total: number;
    items: IProduct[];
}
```

## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом IEvents:
- on - подписка на событие
- emit - инициализация события
- trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

## Слой данных

### Класс ICatalogData
Отвечает за хранение и логику работу с данными каталога товаров.
В полях классах храняться следующие данные:
- _products: IProduct[] - список товаров доступных для покупки
- _events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Набор методов, для дальнейшего взаимодейтсивя с данными:
- getProduct(id: string): IProduct | null - метод для получения информации о конкретном товаре

### Класс IBasketData
Отвечает за храение и логику работы с данными карзины пользователя.\
В полях классах храняться следующие данные:
- products: IProduct[] - массив карточек товаров;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Набор методов, для дальнейшего взаимодейтсивя с данными:
- add(product: IProduct): void - добавление товара в корзину;
- remove(id: string): void - удаление товара из корзины;
- getTotalPrice(): number - метод для подсчета итоговой стоимости корзины.
- checkProductInBasket(id: string): boolean - проверка, находится ли товар в корзине.
- clearBasket(): void - очищение корзины.
- getList(): string[] - возвращает список айдишников товаров в корзине (без null стоимости)
и также сеттеры и геттеры для основных полей.

### Класс IPaymentData
Класс отвечает за хранение данных об оплате и логику работы.
Содержит следующие поля:
- adress: string - адрес покупателя;
- telNum: string - контактный номер покупателя;
- email: string - эл. почта покупателя;
- paymentType: string - тип оплаты;

Набор методов:
- paymentStepValidate() - валидация для шага выбора типа оплаты.
- contactsStepValidate() - валидация для шага заполнения контактных данных.
- getOrderData(): IPayment - возвращает объект с данными об оплате.
Также сеттеры и геттеры для основных полей.

## Слой отображения

#### Класс Modal
Реализует модальное окно. 

- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

Поля класса
- modalContent: HTMLElement - элемент модального окна;
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- pageWrapper: HTMLElement - элемент ДОМ дерева в котором хранится обертка страницы

Методы класса:
- open() - открытие модального окна;
- close() - закрытие модального окна.
- handleEscUp(evt: KeyboardEvent) - прослушиватель события для закрытия окна на Escape
- setContent(content: HTMLElement) - метод установки наполнения модального окна

#### Класс Product
Отвечает за отображение карточки товара.

Поля класса:
- _name - Элемент ДОМ дерева в котором хранится название товара
- _price - Элемент ДОМ дерева в котором хранится цена товара
- _category - Элемент ДОМ дерева в котором хранится категория товара
- _image - Элемент ДОМ дерева в котором хранится картинка товара
- _description - Элемент ДОМ дерева в котором хранится описание товара
- _productId - айди товара
- _basketButton - Кнопка для добавления товара в корзину
- _deleateButton - Кнопка для удаления товара из корзины
- _events - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- _itemIndex: HTMLElement - Элемент ДОМ дерева в котором хранится индекс товара.

Методы:
- disableAddButton() - блокировка кнопки добавления товара в корзину
- render(product: IProduct, index: number) - возвращает карточку с заполненными данными.
- getColorClassName(category: string) - получение названия класса по категории для определения цветов

#### Класс Basket
Класс отвечающий за отображение корзины.

Поля:
- _container: HTMLElement - контейнер корзины;
- _events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- _totalPrice - Элемент ДОМ дерева в котором хранится итоговая цена корзины.
- _basketList - контейнер для списка товаров в корзине
- _orderButton - кнопка для офрмления заказа
- _basketButton - кнопка с корзиной
- _basketCounter - элемент ДОМ дерева в котором хранится количество товара в корзине

Методы:
- render(list: HTMLElement) - метод для отображения корзины. Принимает в себя элемент со списком товаров.
- setPrice(totalPrice: number) - метод для установки цены корзины.
- setDisableOrderButton(value: boolean) - метод для блокировки кнопки оформления заказа.
- setBasketList(list: HTMLElement[]) - метод для установки списка товаров
- setBasketCounter(value: number) - установка значения счетчика товаров в корзине
 
#### Класс ProductsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод addCard(ProductElement: HTMLElement) для добавления карточек на страницу и сеттер container для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

### Класс Payment:
Окно формы с типом оплаты и адресом.

Поля:
- _container: HTMLElement - контейнер для шага выбора оплаты и адреса.
- _events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- _addres: HTMLInputElement - ввод адреса
- _cardButton: HTMLButtonElement - кнопка оплаты картой
- _cashButton: HTMLButtonElement - кнопка оплаты наличными
- _nextButton: HTMLButtonElement - кнопка для перехода на следующий шаг оформления заказа.

Методы:
- setEnableButton() - разблокировка кнопки для перехода на следующий шаг
- setDisableButton() - блокировка кнопки для перехода на следующий шаг
- render() - отображение формы.

### Класс Contacts:
Окно формы для заполнения Эл.адреса и контактного телефона покупателя.

Поля:
- _container: HTMLElement - контейнер для шага заполнения эл. адреса и телефона.
- _telNum: HTMLInputElement - поле ввода контактного телефона
- _email: HTMLInputElement - поле ввода Эл. почты
- _payButton: HTMLButtonElement - кнопка оформления заказа
- _events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы:
- setEnableButton() - разблокировка кнопки для оформления заказа
- setDisableButton() - блокировка кнопки для оформления заказа
- render() - отображение формы.

### Класс Success:
Окно с информацией об успешной покупке

Поля:
- _container: HTMLElement - контейнер для отображения информации.
- _events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- _totalPrice: HTMLElement - элемент ДОМ дерева для отображения итоговой суммы
- _closeButton: HTMLButtonElement - кнопка для возврата к покупкам (закрытие модального окна)

Методы:
- render() - отображение формы.
- setTotalPrice(totalPrice: number) - установка значения итоговой цены покупки

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список событий:
- `initialData:loaded` - событие загрузки начальных данных
- `product:select` - событие клика на карточку товара
- `product:addBasket` - событие добавления товара в корзину
- `product:delete` - событие удаления товара из корзины
- `basket:order` - событие перехода на оформление заказа
- `payment:addresChange` - событие ввода адреса
- `payment:paymentType-change` - событие выбора типа оплаты
- `payment:nextButtonClick` - событие перехода на этап заполнения контактных данных
- `contacts:telNumChange` - событие ввода телефона
- `contacts:emailChange` - событие ввода эл. почты
- `contacts:payButtonClick` - событие отправки запроса на оплату
- `success:closeButtonClick` - событие нажатия кнопки продолжения покупок

## Размещение в сети
Рабочая версия проекта размещена по адресу: https://